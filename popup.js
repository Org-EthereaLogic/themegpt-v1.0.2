const themeSelect=document.getElementById('themeSelect');const followSystem=document.getElementById('followSystem');const applyBtn=document.getElementById('applyBtn');const resetBtn=document.getElementById('resetBtn');async function loadSettings(){const {theme='system',follow=true}=await chrome.storage.sync.get(['theme','follow']);themeSelect.value=theme;followSystem.checked=follow;}async function sendToActiveTab(payload){const [tab]=await chrome.tabs.query({active:true,currentWindow:true});if(!tab)return;try{await chrome.tabs.sendMessage(tab.id,payload);}catch(e){}}applyBtn.addEventListener('click',async()=>{const theme=themeSelect.value;const follow=followSystem.checked;await chrome.storage.sync.set({theme,follow});await sendToActiveTab({type:'APPLY_THEME',theme,follow});window.close();});resetBtn.addEventListener('click',async()=>{await chrome.storage.sync.set({theme:'system',follow:true});await sendToActiveTab({type:'APPLY_THEME',theme:'system',follow:true});window.close();});loadSettings().then(()=>applyBtn.focus());